# STRIDE — Анализ угроз и контроли

| Поток / Элемент | Категория (STRIDE) | Описание угрозы | Контроль | Ссылка на NFR | Проверка / Артефакт |
| :--- | :--- | :--- | :--- | :--- | :--- |
| F1: Auth Requests | S | Подбор пароля. Злоумышленник пытается подобрать пароль пользователя, многократно отправляя запросы на аутентификацию. | Ограничение количества неудачных попыток входа с одного IP-адреса. | `NFR-04` | Интеграционный тест, проверяющий блокировку IP после N неудачных попыток. |
| F1: Auth Requests | I | Небезопасная обработка ошибок аутентификации. Система возвращает разные сообщения об ошибках, позволяя злоумышленнику перебирать существующие логины. | Использовать общее, неспецифичное сообщение об ошибке для всех неудачных попыток входа. | `NFR-02` | Unit/e2e-тесты, проверяющие, что ответы при неверном логине и неверном пароле идентичны. |
| F2: API Calls | E | Доступ к чужим ресурсам. Авторизованный пользователь A пытается получить/изменить/удалить ресурс (проект или запись), принадлежащий пользователю B, путем подмены ID в URL (например, `GET /api/v1/projects/{user_B_project_id}`). | В каждом эндпоинте, работающем с ресурсами, должна быть проверка, что `owner_id` ресурса совпадает с `user_id` из access токена. | `NFR-08` | e2e-тесты, где пользователь A пытается выполнить CRUD-операции над ресурсами пользователя B и получает ошибку 404 (или 403). |
| F2: API Calls with access token | S | Бессрочный доступ при краже токена. Злоумышленник похищает access token пользователя. Если токен имеет очень долгий или неограниченный срок жизни, атакующий получает постоянный доступ к сессии пользователя. | Установить короткое время жизни для access-токенов. | `NFR-07` | Интеграционный тест, который проверяет, что API отклоняет запрос с истекшим токеном. |
| F2: API Calls | D | Отказ в обслуживании из-за большого количества запросов. Злоумышленник отправляет большое количество запросов за короткое время, истощая ресурсы сервера и нарушая SLA по времени ответа для легитимных пользователей. | Внедрить глобальное ограничение частоты запросов. | `NFR-01` | Нагрузочный тест, который показывает, что при превышении заданного RPS API начинает возвращать ответы с кодом `429 Too Many Requests.` |
| F4: DB Queries | R | Отсутствие аудита действий с данными. Невозможно определить, кто и когда создал/изменил/удалил критичные данные (например, проект), что усложняет расследование инцидентов. | Добавить в модели `Project` и `Entry` поля `created_at`, `updated_at` и `owner_id`. Логировать все операции изменения данных с указанием `user_id`. | `NFR-06` | Code review. Проверка схемы БД на наличие полей аудита. Просмотр логов после выполнения тестовых CRUD-операций. |
| F4: App Logic → Database | T | Компрометация учетных записей из-за слабого хеширования. Если при регистрации (поток данных к БД) пароль хешируется слабым алгоритмом, злоумышленник, получивший доступ к БД, сможет быстро подобрать пароли и модифицировать аккаунты пользователей или входить от их имени. | Использовать стойкий к перебору алгоритм хеширования Argon2id с настроенными параметрами сложности перед сохранением хеша в БД. | `NFR-03` | Unit-тест, проверяющий, что метод хеширования возвращает строку в формате Argon2id, и верификация хеша проходит успешно. |
| F6: Logging | I | Утечка чувствительных данных в логи. Приложение логирует тело запроса/ответа или необработанные исключения, содержащие пароли, токены или другую PII. | Настроить фильтрацию и маскирование чувствительных полей в логгере перед записью. Не логировать объекты запроса/ответа целиком. | `NFR-05` | Unit-тест для кастомного фильтра логгера. Ручной просмотр логов в dev-окружении после выполнения запросов, содержащих пароли/токены. |
